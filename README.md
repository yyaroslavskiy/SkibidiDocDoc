# cuddly-chainsaw
Group Project #2. DE: Scraping &amp; API. Python course, HSE University.

**Анализ врачей Москвы: СберЗдоровье и ПроДокторов**

**Цель проекта**
Провести анализ данных о врачах Москвы, собранных с онлайн-платформ СберЗдоровье и ПроДокторов, выявить различия в данных и основные закономерности, и на их основе составить свой независимый рейтинг и создать прототип сервиса, помогающего пользователю выбрать оптимального врача у своего метро по отношению ‘цена/качество’.

**Описание источников данных**
**СберЗдоровье** — цифровая платформа, предоставляющая пользователям возможность записи к врачам, а также информацию о стоимости приёма, рейтингах и доступности специалистов по районам города.
**ПроДокторов** — независимый ресурс, ориентированный на отзывы пациентов и рейтинговую оценку врачей и клиник, что позволяет судить о качестве оказываемых медицинских услуг.
**Этапы работы**
1)Сбор и структурирование данных о врачах Москвы с обеих платформ.
2)Сравнительный анализ стоимости приёма, рейтингов, географии распределения специалистов.
4)Выявление лучших врачей и районов, где сочетание цены, рейтинга и доступности является наиболее выгодным для пациента.
5) MVP - сервис, который поможет лечиться выгодно
Скибиди ДокДок — прототип, который:
-подсказывает лучшие предложения по рейтингу и цене в выбранном районе метро;
-показывает средние показатели по Москве;
-помогает пользователю выбрать оптимального врача с учётом репутации, цены и метро.
Долгосрочная цель
-Построение единого профиля врача с расчётом агрегированного рейтинга, основанного на данных разных платформ. Для этого необходим детальный анализ различий между источниками — в ценах, рейтингах и опыте специалистов.




**Первый этап** - Scraping ПроДокторов и СберЗдоровья, результатом которого является общие датасеты doctors.csv и doctors_review.csv после объединения датасетов с двух сайтов.

**Парсинг ПроДокторов **
  Для парсинга используется BeautifulSoup и Selenium для настройки Chrome, создания окна браузера. 
  Основной функционал разделен на несколько этапов. Сначала мы собираем список всех медицинских специальностей в Москве с указанием количества врачей по каждой специальности. Затем для каждой специальности собираются ссылки на персональные страницы всех врачей.
  Далее мы собираем информацию из профилей врачей. Для каждого доктора собираются: ФИО, ссылка, специальность, словарь клиник с адресами и ближайшими станциями метро, цена, опыт работы, рейтинг, количество отзывов, словарь отзывов с основной страницы. Также ставится отметка, работает ли врач со взрослыми, детьми, одновременно со взрослыми и детьми.
  В примере реализован сбор данных по кардиологам. Датасет сохраняется в csv формат.

Подготовка к merge Продокторов
В данной части работы мы собираем части датасетов с парсинга, так как мы разделяли сбор данных для ускорения процесса. 
После этого подготавливаем данные к merge: 
-раскрываем словарь с клиниками на колонки
-отделяем колонку с отзывами для вынесения её в отдельный датасет 

**data_prodoctorov_to_eda.csv**
Этот датасет содержит информацию о 31209 врачах, практикующих в Москве, собранную с портала ProDoctorov.ru. Данные включают подробную информацию о специалистах, их квалификации, местах работы, стоимости услуг и отзывах пациентов.
Датасет содержит следующие колонки:
- name - ФИО врача
-link - ссылка на профиль на ProDoctorov.ru
- speciality - специализация врача (может содержать несколько специальностей через запятую)
- price - стоимость приема (в рублях)
- experience - опыт работы (в годах)
- rating - рейтинг врача (по 5-балльной шкале)
- review_count - количество отзывов
- is_kids - принимает ли детей (True/False)
- is_adults - принимает ли взрослых (True/False)
- clinics_count - количество клиник, где ведет прием врач
Данные о местах приема представлены в формате до 3 клиник на врача:
- clinic_1_name, clinic_2_name, clinic_3_name - названия клиник
- clinic_1_address, clinic_2_address, clinic_3_address - адреса клиник
- clinic_1_metro, clinic_2_metro, clinic_3_metro - ближайшие станции метро

**data_prodoctorov_reviews_to_eda.csv**
Данный датасет содержит анонимные отзывы пациентов о врачах Москвы, собранные с сайта https://prodoctorov.ru/
Датасет содержит следующие колонки:
- doctor_name - ФИО врача
- doctor_link - ссылка на профиль врача на prodoctorov.ru
- rate - оценка врача по 5-балльной шкале (0.0-5.0), значения "No value" означают отсутствие оценки
- date - дата отзыва в формате YYYY-MM-DD
- comment - текстовый отзыв пациента
- clinic - название и адрес медицинского учреждения в котором был прием
Далее первично обрабатываем данные датасеты:
-приводим типы отдельных признаков к нужному формату
-убираем дубликаты по ссылкам,строки с пустыми значениями
Получаем: 

**prodoctorov_clean.csv
prodoctorov_reviews_clean.csv**
Это датасеты с теми же характеристиками и данными, что и data_prodoctorov_reviews_to_eda.csv и data_prodoctorov_to_eda.csv только с первичной обработкой к merge.

**Описание соединенных датасетов после парсинга:**

**doctors.csv**

Этот датасет содержит информацию о 38865 врачах, практикующих в Москве, собранную с ПроДокторов и СберЗдоровья. Данные включают подробную информацию о специалистах со следующими специальностями: гинеколог, кардиолог, невролог, онколог, терапевт,эндокринолог.
Датасет содержит следующие колонки(33 шт.):
- name - ФИО врача
- experience - опыт работы (в годах)

- rating_sber - рейтинг врача на СберЗдоровье(по 5-балльной шкале)
- review_count_sber - количество отзывов на СберЗдоровье
- price_sber - стоимость приема на СберЗдоровье(в рублях)
-link_sber - ссылка на профиль врача на СберЗдоровье
- clinics_count_sber - количество клиник, где ведет прием врач на СберЗдоровье
Данные о местах приема представлены в формате до 3 клиник на врача:
- clinic_1_name_sber, clinic_2_name_sber, clinic_3_name_sber - названия клиник
- clinic_1_address_sber, clinic_2_address_sber, clinic_3_address_sber - адреса клиник
- clinic_1_metro_sber, clinic_2_metro_sber, clinic_3_metro_sber - ближайшие станции метро

-link_prod - ссылка на профиль врача на ПроДокторов
- price_prod - стоимость приема на ПроДокторов(в рублях)
- rating_prod - рейтинг врача на ПроДокторов(по 5-балльной шкале)
- review_count_prod - количество отзывов на ПроДокторов
- clinics_count_prod - количество клиник, где ведет прием врач на ПроДокторов
Данные о местах приема представлены в формате до 3 клиник на врача:
- clinic_1_name_prod, clinic_2_name_prod, clinic_3_name_prod - названия клиник
- clinic_1_address_prod, clinic_2_address_prod, clinic_3_address_prod - адреса клиник
- clinic_1_metro_prod, clinic_2_metro_prod, clinic_3_metro_prod - ближайшие станции метро

-speciality - специальность врача
- is_kids - принимает ли врач детей (True/False)
- is_adults - принимает ли врач взрослых (True/False)




**doctors_review.csv**
Датасет содержит 1454269 отзывов на врачей из датасета doctors.csv. 
Датасет содержит следующие колонки:
'doctor_name' - ФИО врача
'doctor_link' - ссылка на врача
'rate' - рейтинг врача (от 0 до 5)
'date' - дата, когда был оставлен отзыв
'comment' - отзыв на врача
'clinic' - клиника,в которой проходил лечение пациент


**После получения датасетов мы проводим EDA, разделяя его на три части: EDA doctors, EDA reviews, Geography EDA.** Для Geography EDA мы используем данные полученные с помощью API.

Для географического анализа данных врачей и клиник была проведена работа с адресами и API-картами. На этапе подготовки адреса были очищены и нормализованы.
Попытка использовать открытые API (Nominatim / OSM) показала низкую точность для российских адресов, поэтому для основной обработки выбран API Яндекс Геокодера.
Была реализована система ротации ключей и экспоненциального бэкоффа при ошибках, а также промежуточное сохранение результатов каждые ~200 адресов для устойчивости процесса.
В результате получены координаты, районы и округа для всех адресов, сформирована таблица геоданных, использованная далее в аналитике.

Датасет с координатами **api_addresses.csv**, полученный в результате использования API и
используемый в **Geography EDA:**
Он содержит данные по уникальным адресам клиник из файла doctors.csv, состоит из 4749 строк.
**Описание колонок датасета:**
address - адрес клиники
address_norm - нормализованный адрес(приведенный к единому виду)
latitude - широта 
longitube-долгота
district-район
area-административный округ

**GeographyEDA**
Для работы используется датасет **doctors_with_avg_price** -  аналог doctors, но с уже добавленной средней ценой для врача, также ограничением по координатам Москвы.
Для выполнения анализа создается общий датасет - **data_moskow**.
Из doctors.csv возьмем комбинацию имя доктора-клиника, добавим ссылку, рейтинг, цену с одного ресурса и если есть среднюю, опыт, метро, специальности, с кем работает (дети/взрослые), из датасета с географией - координаты, район и административный округ, из датасета с отзывами - среднюю оценку из отзывов. Далее оставим только координаты, находящиеся в Москве.
В ходе анализа рассматриваются распределения врачей/цен/рейтингов по районам и округам.


**SkibidiDocDoc**

В боте используется финальный датасет для EDA. Бот предоставляет две основные функции:
* Поиск по ФИО (полное либо частичное совпадение)
* Поиск по специальности и метро (формат: Специальность, метро)

Под каждый из этих кейсов реализована команда в боте, также присутствует команда помощи (/help), в которой приведено описание команд.

При поиске по ФИО в случае точного совпадения сразу выдаётся профиль с подробным описанием врача. В случае частичного совпадения (наличия нескольких результатов) сначала выдаётся многостраничный список с краткой информацией по врачам, есть опция выбора конкретного для просмотра подробной информации. 

При поиске по специальности и метро выдаётся аналогичный многостраничный список с возможностью дальнейшего выбора и просмотра профиля врача. В обоих случаях сортировка врачей происходит по рейтингу (убывание) и цене (возрастание).

Сравнение с рынком специалистов происходит по среднему значению рейтинга и цены (взвешенных, которые посчитаны нами) среди врачей с совпадающими специальностями.

